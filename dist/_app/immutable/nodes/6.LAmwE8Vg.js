import{_ as H}from"../chunks/Dp1pzeXC.js";import"../chunks/CWj6FrbW.js";import{i as Z}from"../chunks/D_KrGeLK.js";import{o as ee,b as te,e as C,s as A}from"../chunks/Bvhiy7hU.js";import{n as oe,o as D,z as re,a as M,q as ae,y as c,w as v,v as s,u as j,x as g,t as p}from"../chunks/D-jx113l.js";import{i as G}from"../chunks/De-dCT7C.js";import{a as ne,g as I}from"../chunks/Gws94pYq.js";import{m as a}from"../chunks/C1k9nGEd.js";import{p as ie}from"../chunks/WiVKwmLa.js";var se=D('<button class="dummy-button svelte-c0yxb0">Simulasi: Driver Sampai Pickup</button>'),ue=D('<button class="dummy-button svelte-c0yxb0">Simulasi: Sampai Tujuan</button>'),le=D('<div class="tracking-container svelte-c0yxb0"><div id="map" class="svelte-c0yxb0"></div> <div class="info-panel svelte-c0yxb0"><p><strong>Status:</strong> </p> <p><strong>Jarak:</strong> </p> <p><strong>ETA:</strong> </p></div> <!> <button class="dummy-button cancel-button svelte-c0yxb0">Batalkan Pesanan</button></div>');function Pe(N,O){oe(O,!1);let d=null,f=null,k=null,t,y=j("Menghitung..."),P=j("..."),m=null,b=null,h=null,n=j("driverToPickup");const J="jVkYm2XR18hGm0fCtQtg";async function T(e,o){const r=`https://router.project-osrm.org/route/v1/driving/${e[0]},${e[1]};${o[0]},${o[1]}?overview=full&geometries=geojson`;try{const u=await(await fetch(r)).json();if(!u.routes.length)throw new Error("No route");const l=u.routes[0];p(y,`${Math.round(l.duration/60)} menit`),p(P,`${(l.distance/1e3).toFixed(2)} km`),t.getLayer("route")&&t.removeLayer("route"),t.getSource("route")&&t.removeSource("route"),t.addSource("route",{type:"geojson",data:{type:"Feature",geometry:l.geometry}}),t.addLayer({id:"route",type:"line",source:"route",paint:{"line-color":"#007bff","line-width":5}});const S=new a.LngLatBounds;S.extend(e),S.extend(o),t.fitBounds(S,{padding:50}),q(e,o)}catch(i){console.error(i),p(y,"Gagal"),p(P,"Gagal")}}function q(e,o){document.querySelectorAll(".maplibregl-marker").forEach(r=>r.remove()),s(n)==="driverToPickup"?f=new a.Marker({color:"green"}).setLngLat(e).setPopup(new a.Popup().setText("Driver")).addTo(t):(f=null,new a.Marker({color:"green"}).setLngLat(e).setPopup(new a.Popup().setText("Pickup")).addTo(t)),new a.Marker({color:"blue"}).setLngLat(o).setPopup(new a.Popup().setText(s(n)==="driverToPickup"?"Penjemputan":"Tujuan")).addTo(t)}async function z(){!d||s(n)!=="driverToPickup"||(k=await d.watchPosition({},e=>{if(e&&e.coords&&f){const{latitude:o,longitude:r}=e.coords;f.setLngLat([r,o]),b=[r,o],T(b,m)}}))}function R(){d&&k&&(d.clearWatch({id:k}),k=null)}function B(){p(n,"pickupToDestination"),R(),T(m,h)}function U(){p(n,"Arrived"),t.getLayer("route")&&t.removeLayer("route"),t.getSource("route")&&t.removeSource("route"),document.querySelectorAll(".maplibregl-marker").forEach(e=>e.remove()),new a.Marker({color:"red"}).setLngLat(h).setPopup(new a.Popup().setText("Tujuan Akhir")).addTo(t),t.flyTo({center:h,zoom:15}),p(y,"Tiba"),p(P,"0 km")}const F=()=>{alert("Pesanan dibatalkan (dummy)."),I("/home")};ee(async()=>{if(typeof window<"u"){const l=await H(()=>import("../chunks/C_r86LdB.js"),[],import.meta.url);l&&l.Plugins&&l.Plugins.Geolocation&&(d=l.Plugins.Geolocation)}const e=ne(ie).url,o=e.searchParams.get("driver"),r=e.searchParams.get("pickupCoord"),i=e.searchParams.get("destinationCoord");if(!o||!r||!i)return I("/home");const u=JSON.parse(decodeURIComponent(o));m=JSON.parse(decodeURIComponent(r)),h=JSON.parse(decodeURIComponent(i)),b=[u.lon,u.lat],t=new a.Map({container:"map",style:`https://api.maptiler.com/maps/streets-v2/style.json?key=${J}`,center:m,zoom:13}),t.addControl(new a.NavigationControl,"top-right"),t.on("load",()=>{T(b,m),s(n)==="driverToPickup"&&d&&z()})}),te(()=>{R()}),Z();var _=le(),w=c(v(_),2),x=v(w),V=c(v(x));g(x);var L=c(x,2),W=c(v(L));g(L);var $=c(L,2),Y=c(v($));g($),g(w);var E=c(w,2);{var K=e=>{var o=se();C("click",o,B),M(e,o)},Q=(e,o)=>{{var r=i=>{var u=ue();C("click",u,U),M(i,u)};G(e,i=>{s(n)==="pickupToDestination"&&i(r)},o)}};G(E,e=>{s(n)==="driverToPickup"?e(K):e(Q,!1)})}var X=c(E,2);g(_),re(()=>{A(V,` ${s(n)??""}`),A(W,` ${s(P)??""}`),A(Y,` ${s(y)??""}`)}),C("click",X,F),M(N,_),ae()}export{Pe as component};
