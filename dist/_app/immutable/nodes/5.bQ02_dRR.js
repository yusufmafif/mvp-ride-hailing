import"../chunks/CWj6FrbW.js";import{i as yt}from"../chunks/D_KrGeLK.js";import{o as Pt,s as v,e as B}from"../chunks/Bvhiy7hU.js";import{n as $t,c as bt,f as wt,a as P,q as Ct,t as f,u as $,v as t,o as J,w as n,y as e,x as r,z as E,A as Z,B as tt}from"../chunks/D-jx113l.js";import{i as R}from"../chunks/De-dCT7C.js";import{e as It,s as at}from"../chunks/BdJh3ayb.js";import{g as S,a as Dt}from"../chunks/Gws94pYq.js";import{p as Lt}from"../chunks/WiVKwmLa.js";import{s as et}from"../chunks/B6q9zrgW.js";var At=J('<p class="message info svelte-14r3df7">Mencari driver terdekat...</p>'),Ot=J('<div><div class="driver-info svelte-14r3df7"><h3 class="svelte-14r3df7"> <span style="float: right;"> </span></h3> <p class="svelte-14r3df7"> </p> <p class="svelte-14r3df7">Jarak ke Anda: <strong> </strong></p> <p class="svelte-14r3df7">Estimasi tiba: <strong> </strong></p></div></div>'),Rt=J("<div> </div>"),St=J('<div class="order-confirm-container svelte-14r3df7"><header class="header svelte-14r3df7"><div><strong class="svelte-14r3df7">Konfirmasi Pesanan</strong></div> <button class="logout-button svelte-14r3df7">Logout</button></header> <div class="route-info-display svelte-14r3df7"><p class="svelte-14r3df7"><strong>Penjemputan:</strong> </p> <p class="svelte-14r3df7"><strong>Tujuan:</strong> </p> <p class="svelte-14r3df7"><strong>Jarak:</strong> </p> <p class="svelte-14r3df7"><strong>Waktu Tempuh:</strong> </p> <p class="svelte-14r3df7"><strong>Tarif:</strong> </p></div> <h2 class="section-title svelte-14r3df7">Driver Anda</h2> <!> <div class="driver-list svelte-14r3df7"></div> <button class="confirm-button svelte-14r3df7"><!></button> <!></div>');function Bt(st,rt){$t(rt,!1);let T=$(null),j=$(""),q=$(""),I=null,N=null,D=$(null),L=$([]),u=$(null),m=$("");Pt(async()=>{const{data:{session:o}={}}=await et.auth.getSession();if(!o)return S("/login");f(T,o.user);const i=Dt(Lt).url.searchParams.get("data");if(i){const d=JSON.parse(decodeURIComponent(i));f(j,d.pickup),f(q,d.destination),I=d.pickupCoord,N=d.destinationCoord,f(D,d.routeInfo),I&&await nt(I)}else S("/home")});const nt=async o=>{const[l,i]=o,d=1,b=d/111,g=d/(111*Math.cos(i*Math.PI/180)),w=async(_,c)=>{var C;try{const k=await(await fetch(`https://router.project-osrm.org/nearest/v1/driving/${_},${c}`)).json();if(((C=k.waypoints)==null?void 0:C.length)>0){const[x,A]=k.waypoints[0].location;return[x,A]}}catch(M){console.warn("Snap to road failed:",M)}return[_,c]},h=Array.from({length:1},async(_,c)=>{const C=i+(Math.random()*2-1)*b,M=l+(Math.random()*2-1)*g,[k,x]=await w(M,C),A=ot(i,l,x,k).toFixed(2);return{id:c+1,name:`Driver ${String.fromCharCode(65+c)}`,vehicle:`Motor ${100+c*5}cc`,rating:(Math.random()*1+4).toFixed(1),distance:A,eta:Math.round(Math.random()*5+2),lat:x,lon:k}});f(L,(await Promise.all(h)).sort((_,c)=>_.distance-c.distance)),t(L).length>0&&f(u,t(L)[0])},ot=(o,l,i,d)=>{const g=(i-o)*Math.PI/180,w=(d-l)*Math.PI/180,h=Math.sin(g/2)*Math.sin(g/2)+Math.cos(o*Math.PI/180)*Math.cos(i*Math.PI/180)*Math.sin(w/2)*Math.sin(w/2);return 6371*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))},it=o=>{f(u,o)},dt=async()=>{if(!t(u)){f(m,"Mohon pilih driver terlebih dahulu.");return}f(m,"Mengirim pesanan Anda..."),await new Promise(d=>setTimeout(d,2e3)),console.log("Order confirmed!",{user:t(T).id,pickup:t(j),destination:t(q),pickupCoord:I,destinationCoord:N,routeInfo:t(D),selectedDriverId:t(u).id});const o=encodeURIComponent(JSON.stringify(t(u))),l=encodeURIComponent(JSON.stringify(I)),i=encodeURIComponent(JSON.stringify(N));S(`/tracking?driver=${o}&pickupCoord=${l}&destinationCoord=${i}`)},ct=async()=>{await et.auth.signOut(),S("/login")};yt();var W=bt(),lt=wt(W);{var vt=o=>{var l=St(),i=n(l),d=e(n(i),2);r(i);var b=e(i,2),g=n(b),w=e(n(g));r(g);var h=e(g,2),_=e(n(h));r(h);var c=e(h,2),C=e(n(c));r(c);var M=e(c,2),k=e(n(M));r(M);var x=e(M,2),A=e(n(x));r(x),r(b);var G=e(b,4);{var pt=s=>{var a=At();P(s,a)};R(G,s=>{t(L).length===0&&s(pt)})}var U=e(G,2);It(U,5,()=>t(L),s=>s.id,(s,a)=>{var p=Ot(),y=n(p),K=n(y),H=n(K),Q=e(H),_t=n(Q);r(Q),r(K);var F=e(K,2),Mt=n(F,!0);r(F);var z=e(F,2),V=e(n(z)),kt=n(V);r(V),r(z);var X=e(z,2),Y=e(n(X)),xt=n(Y);r(Y),r(X),r(y),r(p),E(()=>{at(p,1,`driver-card ${t(u)&&t(u).id===t(a).id?"selected":""}`,"svelte-14r3df7"),v(H,`${t(a).name??""} `),v(_t,`â­ ${t(a).rating??""}`),v(Mt,t(a).vehicle),v(kt,`${t(a).distance??""} km`),v(xt,`${t(a).eta??""} menit`)}),B("click",p,()=>it(t(a))),P(s,p)}),r(U);var O=e(U,2),ft=n(O);{var ut=s=>{var a=tt("Mengirim Pesanan...");P(s,a)},mt=s=>{var a=tt("Konfirmasi Pesanan");P(s,a)};R(ft,s=>{t(m).includes("Mengirim pesanan Anda")?s(ut):s(mt,!1)})}r(O);var gt=e(O,2);{var ht=s=>{var a=Rt(),p=n(a,!0);r(a),E(y=>{at(a,1,`message ${y??""}`,"svelte-14r3df7"),v(p,t(m))},[()=>t(m).includes("dikonfirmasi")?"success":t(m).includes("Mohon pilih")?"info":"error"],Z),P(s,a)};R(gt,s=>{t(m)&&s(ht)})}r(l),E(s=>{var a,p,y;v(w,` ${t(j)??""}`),v(_,` ${t(q)??""}`),v(C,` ${((a=t(D))==null?void 0:a.distance)??""}`),v(k,` ${((p=t(D))==null?void 0:p.duration)??""}`),v(A,` ${((y=t(D))==null?void 0:y.tarif)??""}`),O.disabled=s},[()=>!t(u)||t(m).includes("Mengirim pesanan Anda")],Z),B("click",d,ct),B("click",O,dt),P(o,l)};R(lt,o=>{t(T)&&o(vt)})}P(st,W),Ct()}export{Bt as component};
